---
description: 为了窃取凭证，并用此在目标上进行身份验证
---

# ✔️ 查找当前已登录的用户账户

## 先决条件

* 已经列出了目标域中的所有用户账户、所有组成员身份信息
* 已确定了目标域中的管理用户账户
* 接下来从这些管理用户账户中查找已登录的用户账户

## 目的

* 因为高权限组成员中的已登录账户的凭证是会被缓存到内存中的，接下来可以通过窃取该凭证，并利用次进行身份验证。若该登录账户为域管理员的话，最终将接管整个目标域。
* 如果无法立即攻破域管理员的账号，则必须攻破其他账户或机器，最终达到那个级别的访问权限

## &#x20;方法

```powershell
# 使用前先导入
Import-Module .\PowerView.ps1
# 查询指定主机上已登录的用户的详细信息
Get-NetLoggedon -ComputerName 计算机名
# 接下来查询在域控上的活动会话 
Get-NetSession -ComputerName 域控名
```

* 以上两条命令：
  * 用于获取在指定计算机上当前登录的用户列表，它可以识别哪些用户在目标计算机上有活跃的登录会话（可获取用户名）
  * 获取指定域控制器上的活跃会话信息，它可以列出当前与指定计算机（通常是域控制器）有活动会话的用户（可获取当前与域控的活跃会话的用户列表，包括哪些用户正在与域控进行会话）
* 总结：识别出更高权限用户，因为只有这些用户才需要访问域控制器

## 链式攻击路径

* 每一步都依赖于前一步成功获取的访问权限或信息，从而构成一条贯穿多个系统、用户或服务的攻击路径
* 利用已知信息，逐步提升权限
* 横向移动，灵活应变，动态调整攻击路径和策略

## Tips

* 在一个真实的 Active Directory 基础架构中，通过每个 API 获得的信息可能会有所不同，并且肯定会更加有用。
* 可获取到：
  * **当前登录用户信息**：了解哪些用户在目标计算机上活跃登录。
  * **活跃会话信息**：了解哪些用户与域控制器有活跃会话。
  * **高权限用户活动**：识别高权限用户的位置和活动情况，有助于制定下一步攻击计划。
  * **潜在攻击路径**：通过识别用户会话，确定潜在的攻击路径和目标，特别是高权限用户的活动范围。

{% hint style="info" %}
2个相关的Windows函数(API)：

* NetWkstaUserEnum（需要管理员权限）
* NetSessionEnum

PowerView脚本中涉及的函数(API)：

* Get-NetLoggedon
* Get-NetSession
{% endhint %}
