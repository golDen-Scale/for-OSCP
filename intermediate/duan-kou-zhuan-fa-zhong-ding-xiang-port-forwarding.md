---
description: 用于绕过防火墙和访问控制策略，以实现对目标系统内部资源的访问  / 持久访问
---

# ✔️ 端口重定向和隧道 - Port Redirection and Tunneling

## 概述

### 端口转发

* 作用于不同主机，将要传输的流量从主机A的端口引到主机B的特定端口
* 用于从外网访问内网的情况，将外部流量转发到内部网络的某个指定端口上

### 端口重定向

* 在同一台主机上，将要传输的流量从一个端口引到另一个端口
* 用于突破内网的一些本地防火墙规则的限制
* 横向移动 / 跳板 / 隐藏流量

### 隧道传输

* 将一个网络协议的流量封装在其他的网络协议的隧道中进行传输
* 用于绕过屏蔽的端口，可以在内网中创建点对点连接，从而突破网络隔离

### 流量封装

* 将流量封装在另一个网络协议的包头中进行传输
* 横向移动 / 隐藏流量 / 穿透防火墙规则限制

{% hint style="info" %}
* 端口转发、端口重定向涉及到将流量从一个端口引到另一个端口
* 隧道传输、流量封装涉及到将流量封装在其他协议中便于传输
* 它们的目的和实现方式有所不同
{% endhint %}

## 常用工具

### 基于Unix系统

#### RINETD&#x20;

* 常见场景：将已经获取到控制权的目标外部网络的主机端口上的流量，转发到目标内部网络中访问受限制的主机的指定端口上：

```bash
# [本地IP] [本地端口] [目标IP] [目标端口]
127.0.0.1 4444 192.168.xxx.xx 80
```

* 重启&确认端口是否已经成功监听：

```bash
service rinted restart
ss -antp | grep "4444"
```

* 再连接本地的4444端口即可：

```bash
nc -nvv 10.10.xxx.xxx 4444
```

### 基于Windows系统

#### PLINK.exe&#x20;

<pre class="language-powershell"><code class="lang-powershell">plink.exe
# 使用plink.exe来建立一个SSH远程端口转发: 
<strong>    # 要登录主机的用户名和密码
</strong>    # [目标IP]:[目标端口]:[本地IP]:[本地端口]
    # 目标IP
plink.exe -ssh -l 用户名 -pw 密码 -R 192.168..xxx:1234:127.0.0.1:1234 192.168.xxx.xxx
</code></pre>

#### NETSH

```bash
// Some code
```





## SSH隧道

* 既可以基于Unix系统，又可以基于Windows系统（只要有SSH客户端和服务端即可）
* 作用&优势：
  * 传输数据加密，转发的流量在加密通道中传输
  * 绕过防火墙/IDS等边界设备
  * 可封装和传输其他协议的流量（HTTP/HTTPS/RDP）
  * 可远程访问控制
  * 便于脚本化和自动化

### SSH本地端口转发

* 允许将本地计算机的端口流量转发到远程主机上的指定端口

```bash
# [本地端口]:[目标IP]:[目标端口] 
# 连接后会执行命令
ssh -L 1234:192.168.xxx.xxx:3306 admin@10.10.xx.xxx
# 连接后只转发不执行任何命令
ssh -N -L 1234:192.168.xxx.xxx:3306 admin@10.10.xx.xxx
```

### SSH远程端口转发

* 允许将远程主机的端口流量转发到本地计算机上的指定端口

```bash
# [本地端口]:[目标IP]:[目标端口]
ssh -N -R 1234:192.168.xxx.xxx:3389 admin@10.10.xxx.xxx
# 
```

### SSH动态端口转发

* 通过 SOCKS 代理转发流量，可以代理访问任意远程主机和端口

```bash
// Some code
```

## HTTP隧道







## HTTPS隧道





## DNS隧道

